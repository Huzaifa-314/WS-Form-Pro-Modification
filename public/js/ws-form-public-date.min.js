!function(t){"use strict";t.WS_Form.prototype.form_date=function(){if(!t('[data-type="datetime"] input',this.form_canvas_obj).length)return!1;if("off"==t.WS_Form.settings_plugin.ui_datepicker)return!1;if(this.form_date_datetimepicker_enabled())this.form_date_process();else if(this.native_date){var e=this;t('[data-type="datetime"] input',this.form_canvas_obj).each(function(){var a=t(this).attr("value");if(""==a)return!1;var i=t(this).attr("data-date-type");try{switch(i){case"datetime-local":var r=new Date(a),s=new Date(r.valueOf()-6e4*r.getTimezoneOffset()).toISOString();a=s.substring(0,s.length-1)}}catch(t){e.error("error_datetime_default_value",t)}t(this).val(a)})}this.form_date_validity()},t.WS_Form.prototype.form_date_datetimepicker_enabled=function(){return"function"==typeof jQuery().datetimepicker&&"object"==typeof jQuery.datetimepicker&&"function"==typeof jQuery.datetimepicker.setLocale&&"function"==typeof jQuery.datetimepicker.setDateFormatter&&("on"==t.WS_Form.settings_plugin.ui_datepicker||"native"==t.WS_Form.settings_plugin.ui_datepicker&&!this.native_date)},t.WS_Form.prototype.form_date_process=function(e){var a=this;void 0===e&&(e=t('[data-type="datetime"] input',this.form_canvas_obj));var i=ws_form_settings.locale.substring(0,2);jQuery.datetimepicker.setLocale(i),e.each(function(){var e=a.get_field(t(this));if(t(this).is("[readonly]"))t(this).datetimepicker("destroy");else{var i=t(this).attr("data-date-type"),r=t(this).attr("data-date-format")?t(this).attr("data-date-format"):ws_form_settings.date_format,s=t(this).attr("data-time-format")?t(this).attr("data-time-format"):ws_form_settings.time_format,d=t(this).attr("data-time-step")?parseInt(t(this).attr("data-time-step"),10):15;d<=0&&(d=15);var o={allowBlank:!0,validateOnBlur:!1,scrollInput:!1,formatDate:"Y-m-d",formatTime:s};void 0!==t(this).attr("data-inline")&&(o.inline=!0);var n=t(this).attr("data-dow-start")?parseInt(t(this).attr("data-dow-start"),10):1;n<0&&(n=0),n>6&&(n=6),o.dayOfWeekStart=n;var _=t(this).attr("min");if(_)if("+"!=_.charAt(0)&&"-"!=_.charAt(0)){var f=parseInt(ws_form_settings.gmt_offset,10),l=new Date(_);l.setHours(l.getHours()+-1*f),o.minDate=a.date_format(l,"Y-m-d"),"time"===i&&(o.minTime=_)}else o.minDate=_;var m=t(this).attr("max");if(m)if("+"!=m.charAt(0)&&"-"!=m.charAt(0)){f=parseInt(ws_form_settings.gmt_offset,10);var c=new Date(m);c.setHours(c.getHours()+-1*f),o.maxDate=a.date_format(c,"Y-m-d"),"time"===i&&(o.maxTime=m)}else o.maxDate=m;var h=t(this).attr("data-year-start");h&&(o.yearStart=h);var v=t(this).attr("data-year-end");switch(v&&(o.yearEnd=v),i){case"date":o.format=r,o.timepicker=!1,o.closeOnDateSelect=!0;break;case"time":o.format=s,o.datepicker=!1,o.step=d,o.closeOnDateSelect=!0;break;case"month":o.format="F Y",o.timepicker=!1,o.closeOnDateSelect=!0;break;case"week":var p="";a.language("week").split("").map(t=>{p+="\\"+t}),o.format=p+" W, Y",o.timepicker=!1,o.weeks=!0,o.closeOnDateSelect=!0;break;default:o.format=r+" "+s,o.step=d}a.conversational&&(o.onShow=function(e,a){var i=t(".xdsoft_datetimepicker").first();a.after(i)});var u=[],g=a.get_object_meta_value(e,"disabled_week_days");if("object"==typeof g&&g.length)for(var y in g)if(g.hasOwnProperty(y)){var b=g[y];void 0!==b.disabled_week_days_day&&(b=parseInt(b.disabled_week_days_day,10))>=0&&b<=6&&u.push(b)}u.length>0&&(o.disabledWeekDays=u);var k=[],w=a.get_object_meta_value(e,"disabled_dates");if("object"==typeof w&&w.length)for(var D in w)if(w.hasOwnProperty(D)){var j=w[D];void 0!==j.disabled_dates_date&&""!=j.disabled_dates_date&&k.push(j.disabled_dates_date)}k.length>0&&(o.disabledDates=k);var S=[],F=a.get_object_meta_value(e,"enabled_dates");if("object"==typeof F&&F.length)for(var O in F)if(F.hasOwnProperty(O)){var W=F[O];void 0!==W.enabled_dates_date&&""!=W.enabled_dates_date&&S.push(W.enabled_dates_date)}S.length>0&&(o.allowDates=S),t(this).datetimepicker(o)}})},t.WS_Form.prototype.form_date_validity=function(){if(void 0!==jQuery().datetimepicker){var e=this;t('input[type="text"][data-date-type]:not([data-hidden],[data-hidden-section],[data-hidden-group]), input[type="text"][data-date-type]:not([data-hidden],[data-hidden-section],[data-hidden-group])',this.form_canvas_obj).each(function(){e.field_date_validity_process(t(this)),t(this).on("change",function(){e.field_date_validity_process(t(this))})})}},t.WS_Form.prototype.field_date_validity_process=function(t){this.get_field_id(t);var e=this.get_field(t);this.set_invalid_feedback(t,"");var a=t.val();if(""!==a){var i=t.attr("data-date-type");switch(i){case"week":case"month":case"time":return}var r=t.attr("data-date-format")?t.attr("data-date-format"):ws_form_settings.date_format,s=this.get_date(a,i,r);if(this.date_valid(s)){var d=this.parse_date_min_max(t,"min"),o=this.parse_date_min_max(t,"max");if(d&&s<d||o&&s>o)this.set_invalid_feedback(t,!1);else{var n=this.get_object_meta_value(e,"disabled_week_days");if("object"==typeof n&&n.length)for(var _ in n)if(n.hasOwnProperty(_)){var f=n[_];if(void 0!==f.disabled_week_days_day&&(f=parseInt(f.disabled_week_days_day,10))>=0&&f<=6&&s.getDay()===f)return void this.set_invalid_feedback(t,!1)}var l=this.get_object_meta_value(e,"disabled_dates");if("object"==typeof l&&l.length)for(var m in l){var c;if(l.hasOwnProperty(m))if(void 0!==(c=l[m]).disabled_dates_date)if(""!=c.disabled_dates_date)if((c=this.get_date(c.disabled_dates_date,"date","Y-m-d")).getFullYear()===s.getFullYear()&&c.getMonth()===s.getMonth()&&c.getDate()===s.getDate())return void this.set_invalid_feedback(t,!1)}var h=this.get_object_meta_value(e,"enabled_dates");if("object"==typeof h&&h.length){var v=!1,p=!1;for(var u in h){var g;if(h.hasOwnProperty(u))if(void 0!==(g=h[u]).enabled_dates_date)if(""!=g.enabled_dates_date)(g=this.get_date(g.enabled_dates_date,"date","Y-m-d")).getFullYear()===s.getFullYear()&&g.getMonth()===s.getMonth()&&g.getDate()===s.getDate()&&(v=!0),p=!0}if(p&&!v)return void this.set_invalid_feedback(t,!1)}}}else this.set_invalid_feedback(t,!1)}},t.WS_Form.prototype.parse_date_min_max=function(t,e){var a=t.attr(e);if(!a)return"";var i=0,r=t.attr("data-date-type");switch(r){case"date":case"datetime-local":case"week":case"month":var s=a.substring(0,1);if("-"===s||"+"===s){var d=a.substring(1),o=new Date(d);if(!this.date_valid(o))return"";var n=(n=Math.floor(o/864e5))*("-"===s?-1:1);return(_=new Date).setHours(0,0,0,0),_.setDate(_.getDate()+n),_}}switch(r){case"date":a+=" 00:00:00";break;case"datetime-local":i=parseInt(ws_form_settings.gmt_offset,10);break;case"time":a="01/01/1970 "+a}var _=new Date(a);return this.date_valid(_)?(_.setHours(_.getHours()+-1*i),_):""},t.WS_Form.prototype.date_valid=function(t){return t instanceof Date&&!isNaN(t.valueOf())}}(jQuery);