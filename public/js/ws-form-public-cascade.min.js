!function(a){"use strict";a.WS_Form.prototype.form_cascade=function(){var e=this;a("[data-cascade-field-id]:not([data-init-cascade]) input:checked",this.form_canvas_obj).attr("data-checked",""),a("[data-cascade-field-id]:not([data-init-cascade])",this.form_canvas_obj).each(function(){var t=a(this),c=a(this).closest("[data-type]");if(void 0===a(this).attr("data-init-cascade")){var i=a(this).attr("data-cascade-field-id"),o=c.attr("data-repeatable-index");a('[data-cascade-field-id="'+i+'"]',c).attr("data-init-cascade","");var s=!1;if(o)(s=a('[id^="'+e.form_id_prefix+"field-wrapper-"+i+'"][data-id="'+i+'"][data-repeatable-index="'+o+'"]',e.form_canvas_obj)).length||(s=!1);if(!s)s=a('[id^="'+e.form_id_prefix+"field-wrapper-"+i+'"][data-id="'+i+'"]',e.form_canvas_obj);if(s.length){switch(s.attr("data-type")){case"text":case"number":case"rating":case"range":case"price_range":var d="change input";break;default:d="change"}s.on(d,function(){e.form_cascade_process(s,c,t)}),e.form_cascade_process(s,c,t)}}})},a.WS_Form.prototype.form_cascade_process=function(e,t,c){var i=this,o=t.attr("data-id"),s=this.field_data_cache[o],d=t.attr("data-repeatable-index");d||(d=0);var r=t.attr("data-type"),n=e.attr("data-id"),l=e.attr("data-repeatable-index"),h=void 0!==l?"["+l+"]":"",_=e.attr("data-type"),p=this.field_name_prefix+n+h,f=i.get_object_meta_value(s,r+"_cascade_option_text_no_rows","");""==f&&(f=i.language("cascade_option_text_no_rows"));var v=this.get_object_meta_value(s,r+"_cascade_no_match",!1);switch(_){case"select":case"price_select":var u=a('[name="'+p+'[]"]',this.form_canvas_obj).val();break;case"checkbox":case"price_checkbox":case"radio":case"price_radio":u=[];a('[name="'+p+'[]"]:checked',this.form_canvas_obj).each(function(){u.push(a(this).val())});break;default:u=a('[name="'+p+'"]',this.form_canvas_obj).val()}switch(null===u||""===u||void 0===u||"object"==typeof u&&0===u.length?u=!1:"object"!=typeof u&&(u=[u]),r){case"select":case"price_select":var m=a("select",t);if(void 0!==c.attr("data-wsf-select2"))var g=a("+ .select2",c);else g=!1;if(void 0!==c.attr("data-cascade-ajax")){if(this.form_post_locked||"object"!=typeof this.api_call_handle[o]||this.api_call_handle[o].abort(),!1===u&&!v)return void m.html('<option value="" data-placeholder>'+f+"</option>").val("");var b=i.get_object_meta_value(s,"placeholder_row",""),x=this.get_object_meta_value(s,r+"_cascade_ajax_option_text_loading","");""==x&&(x=this.language("cascade_option_text_loading")),g&&this.form_cascade_set_select2_placeholder(m,x);var j=""!==m.val()&&null!==m.val();m.html('<option value="" data-placeholder>'+x+"</option>").val(""),j&&m.trigger("change");var w=new FormData;w.append("id",this.form_id),w.append("value",JSON.stringify(u)),w.append("preview",this.form_canvas_obj[0].hasAttribute("data-preview")),this.api_call_handle[o]=this.api_call("field/"+o+"/cascade/","GET",w,function(e){if(e.data){var c=i.get_field_html(e.data,t.attr("data-repeatable-index")),o=a("select",a(c)).html();o?(g&&i.form_cascade_set_select2_placeholder(m,b),m.html(o)):(g&&i.form_cascade_set_select2_placeholder(m,f),m.html('<option value="" data-placeholder>'+f+"</option>").val("")),a("optgroup",m).each(function(){a("option",a(this)).length||a(this).remove()})}})}else{m=a("select",t);void 0===this.cascade_cache[o]&&(this.cascade_cache[o]=[]),void 0===this.cascade_cache[o][d]&&(this.cascade_cache[o][d]='<select id="wsf-cascade-scratch">'+m.html()+"</select>");var y=a(this.cascade_cache[o][d]),k=this.get_object_meta_value(s,r+"_cascade_field_filter_comma",!1),O=!1;if(!1!==u&&a("option",y).each(function(){if("string"==typeof(c=a(this).attr("data-cascade-value"))){var e=k?c.split(","):[c];for(var t in e)if(e.hasOwnProperty(t)){var c=e[t];if(-1!==u.indexOf(c))return O=!0,!1}}}),!O)return(v=this.get_object_meta_value(s,r+"_cascade_no_match",!1))?m.html(y.html()):m.html('<option value="" data-placeholder>'+f+"</option>").val(""),void m.trigger("change");a("option",y).each(function(){if("string"==typeof(i=a(this).attr("data-cascade-value"))){var e=k?i.split(","):[i],t=!1;for(var c in e)if(e.hasOwnProperty(c)){var i=e[c];if(-1!==u.indexOf(i)){t=!0;break}}t||a(this).remove()}}),a("optgroup",y).each(function(){a("option",a(this)).length||a(this).remove()}),m.html(y.html()),m.trigger("change")}break;case"checkbox":case"price_checkbox":case"radio":case"price_radio":O=!1,k=this.get_object_meta_value(s,r+"_cascade_field_filter_comma",!1);if(!1!==u&&a("[data-cascade-value]",t).each(function(){if("string"==typeof(c=a(this).attr("data-cascade-value"))){var e=k?c.split(","):[c];for(var t in e)if(e.hasOwnProperty(t)){var c=e[t];if(-1!==u.indexOf(c))return O=!0,!1}}}),(v=this.get_object_meta_value(s,r+"_cascade_no_match",!1))&&!O)return a("[data-cascade-value]",t).show().attr("data-cascade-on",""),void a("fieldset",t).show();O?a("[data-cascade-value]",t).each(function(){if("string"==typeof(i=a(this).attr("data-cascade-value"))){var e=k?i.split(","):[i],t=!1;for(var c in e)if(e.hasOwnProperty(c)){var i=e[c];if(-1!==u.indexOf(i)){t=!0;break}}t?a(this).show().attr("data-cascade-on",""):a(this).hide().removeAttr("data-cascade-on")}}):a("[data-cascade-value]",t).hide().removeAttr("data-cascade-on"),a("fieldset",t).show().each(function(){a("[data-cascade-value][data-cascade-on]",a(this)).length||a(this).hide()}),a("[data-cascade-value]:not([data-cascade-on]) input:checked",t).each(function(){a(this).prop("checked",!1).trigger("change")}),a("[data-cascade-value][data-cascade-on] input[data-checked]:not(:checked)",t).each(function(){a(this).prop("checked",!0).trigger("change")})}},a.WS_Form.prototype.form_cascade_set_select2_placeholder=function(a,e){var t=a.data("select2");t&&t.selection&&t.selection.placeholder&&t.selection.placeholder.text&&(t.selection.placeholder.text=e)}}(jQuery);