!function(t){"use strict";t.WS_Form.prototype.form_analytics=function(){(this.get_object_meta_value(this.form,"analytics_google",!1)||this.action_ga)&&this.form_analytics_google()},t.WS_Form.prototype.form_analytics_google=function(a){var e=this,i=t.WS_Form.analytics.google.functions;if(void 0===a&&(a=(new Date).getTime()),(new Date).getTime()-a>this.timeout_analytics_google)return this.error("error_timeout_analytics_google","","analytics"),!1;var o=!1;for(var n in i)if(i.hasOwnProperty(n)){var s=i[n];if(window[n]){o=!0,this.log(s.log_found,"","analytics");var r=this.get_object_meta_value(this.form,"analytics_google",!1),_=r&&this.get_object_meta_value(this.form,"analytics_google_event_form",!0),l=r&&this.get_object_meta_value(this.form,"analytics_google_event_tab",!0),c=r&&this.get_object_meta_value(this.form,"analytics_google_event_field",!0);this.form_analytics_process("google",n,c,l,_),this.analytics_function.google=n;break}}o||setTimeout(function(){e.form_analytics_google(a)},this.timeout_interval)},t.WS_Form.prototype.form_analytics_process=function(t,a,e,i,o){o&&this.form_analytics_process_forms(t,a),i&&Object.keys(this.form.groups).length>0&&this.form_analytics_process_tabs(t,a),e&&this.form_analytics_process_fields(t,a)},t.WS_Form.prototype.form_analytics_process_forms=function(a,e){var i=this,o=t.WS_Form.analytics[a].functions[e],n=t.WS_Form.analytics[a].label,s=o.label;t(document).on("wsf-submit wsf-save",function(t,o,n,s,r,_){if(r===i.form_obj){var l={category:i.js_string_encode(i.language("analytics_category",i.form.label)),action:"wsf-submit"===t.type?"Submit":"Save",label:"",value:"null"};if(i.form_analytics_event_fire(a,e,l),"wsf-submit"===t.type&&void 0!==window.dataLayer&&"function"==typeof window.dataLayer.push){var c={event:"gtm.formSubmit","gtm.element":i.form_obj[0],"wsf.form.id":i.js_string_encode(i.form_id),"wsf.form.instance_id":i.js_string_encode(i.form_instance_id),"wsf.form.label":i.js_string_encode(i.form.label)};void 0!==i.form_obj.attr("id")&&(c["gtm.elementId"]=i.form_obj.attr("id")),void 0!==i.form_obj.attr("class")&&(c["gtm.elementClasses"]=i.form_obj.attr("class")),void 0!==i.form_obj.attr("action")&&(c["gtm.elementUrl"]=i.form_obj.attr("action")),window.dataLayer.push(c),i.log("log_analytics_event_fired","dataLayer gtm.formSubmit event","analytics")}}}),i.log("log_analytics_event_form",n+" ("+s+")","analytics")},t.WS_Form.prototype.form_analytics_process_tabs=function(a,e){var i=this,o=t.WS_Form.analytics[a].functions[e],n=t.WS_Form.analytics[a].label,s=o.label,r=void 0!==this.framework.tabs.public.selector_href?this.framework.tabs.public.selector_href:"href";t("["+r+'^="#'+this.form_id_prefix+'group-"]:not([data-init-analytics-tab])',this.form_canvas_obj).each(function(){t(this).attr("data-init-analytics-tab",""),t(this).on("wsf-click",function(){var o=t(this).parent().index();if(void 0===t(this).attr("data-analytics-event-fired")){var n=i.form.groups[o],s={category:i.js_string_encode(i.language("analytics_category",i.form.label)),action:"Tab",label:i.js_string_encode(n.label),value:"null"};i.form_analytics_event_fire(a,e,s),t(this).attr("data-analytics-event-fired","true")}})}),i.log("log_analytics_event_tab",n+" ("+s+")","analytics")},t.WS_Form.prototype.form_analytics_process_fields=function(a,e){var i=this,o=t.WS_Form.analytics[a].functions[e],n=t.WS_Form.analytics[a].label,s=o.label;for(var r in this.field_data_cache)if(this.field_data_cache.hasOwnProperty(r)){var _=this.field_data_cache[r].type,l=t.WS_Form.field_type_cache[_];if(void 0!==l.events){var c=l.events.event,f=this.field_data_cache[r].id,m=void 0!==l.submit_array&&l.submit_array;t('[data-type][data-id="'+f+'"]',this.form_canvas_obj).each(function(){var o=i.get_section_repeatable_index(t(this)),n=o>0?"["+o+"]":"";if(m)var s=t('[name="'+ws_form_settings.field_prefix+f+n+'[]"]:not([data-init-analytics-field])',i.form_canvas_obj);else s=t('[name="'+ws_form_settings.field_prefix+f+n+'"]:not([data-init-analytics-field])',i.form_canvas_obj);s.length&&(s.attr("data-init-analytics-field",""),s.on(c,function(){if(void 0===t(this).attr("data-analytics-event-fired")){var o=i.get_field(t(this)),n=t.WS_Form.field_type_cache[o.type].events.event_action,s={category:i.js_string_encode(i.language("analytics_category",i.form.label)),action:n,label:i.js_string_encode(o.label),value:"null"};i.form_analytics_event_fire(a,e,s),t(this).attr("data-analytics-event-fired","true")}}))})}}i.log("log_analytics_event_field",n+" ("+s+")","analytics")},t.WS_Form.prototype.form_analytics_event_fire=function(a,e,i){var o=t.WS_Form.analytics[a].functions[e],n=t.WS_Form.analytics[a].label,s=t.WS_Form.analytics[a].functions[e].label,r=o.analytics_event_function,_=this.mask_parse(r,i);"js"==e||"function"==typeof window[e]?(t.globalEval("(function($) {"+_+"})(jQuery);"),this.log("log_analytics_event_fired",n+" ("+s+") "+_,"analytics")):this.error("log_analytics_event_failed",n+" ("+s+") "+_,"analytics")},t.WS_Form.prototype.action_conversion=function(a,e){if(void 0===a)return!1;if(void 0===t.WS_Form.analytics[a])return!1;if(void 0===t.WS_Form.analytics[a].functions)return!1;if(void 0!==this.analytics_function[a])var i=this.analytics_function[a];else i=Object.keys(t.WS_Form.analytics[a].functions)[0];"function"==typeof this.form_analytics_event_fire&&this.form_analytics_event_fire(a,i,e),this.action_js_process_next()}}(jQuery);