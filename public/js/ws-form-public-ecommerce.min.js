!function(e){"use strict";e.WS_Form.prototype.form_ecommerce=function(){var t=this;if(this.has_ecommerce=e("[data-ecommerce-price],[data-ecommerce-cart-price],[data-ecommerce-cart-total],[data-ecommerce-payment]",this.form_canvas_obj).length,this.has_ecommerce){for(var r in e.WS_Form.ecommerce.cart_price_types)e.WS_Form.ecommerce.cart_price_types.hasOwnProperty(r)&&this.form_add_hidden_input("wsf_ecommerce_cart["+r+"]","",t.form_id_prefix+"ecommerce-cart-"+r);this.form_add_hidden_input("wsf_ecommerce_cart[total]","",t.form_id_prefix+"ecommerce-cart-total"),this.form_add_hidden_input("wsf_ecommerce_transaction","",t.form_id_prefix+"ecommerce-transaction"),this.form_add_hidden_input("wsf_ecommerce_transaction_id","",t.form_id_prefix+"ecommerce-transaction-id"),this.form_add_hidden_input("wsf_ecommerce_status","",t.form_id_prefix+"ecommerce-status"),this.form_add_hidden_input("wsf_ecommerce_payment_method","",t.form_id_prefix+"ecommerce-payment-method"),this.form_ecommerce_set_status("new"),this.ecommerce_cart_price_type=[],this.form_ecommerce_input_mask_currency(),e("input[data-ecommerce-price]:not([data-init-ecommerce-event]),input[data-ecommerce-cart-price]:not([data-init-ecommerce-event]),select[data-ecommerce-price]:not([data-init-ecommerce-event])",this.form_canvas_obj).on("keyup change input paste",function(r){if(e(this).attr("data-init-ecommerce-event",""),void 0!==e(this).attr("min")){var a=parseInt(e(this).attr("min"),10);"input"==r.type&&parseInt(e(this).val(),10)<a&&e(this).val(a)}if(void 0!==e(this).attr("max")){var c=parseInt(e(this).attr("max"),10);"input"==r.type&&parseInt(e(this).val(),10)>c&&e(this).val(c)}t.form_ecommerce_calculate()}),e("input[data-ecommerce-quantity]:not([data-init-ecommerce-event])",this.form_canvas_obj).on("keyup change input paste",function(r){if(e(this).attr("data-init-ecommerce-event",""),"change"==r.type&&""==e(this).val()&&e(this).val(0),void 0!==e(this).attr("min")){var a=parseInt(e(this).attr("min"),10);"input"==r.type&&parseInt(e(this).val(),10)<a&&e(this).val(a)}if(void 0!==e(this).attr("max")){var c=parseInt(e(this).attr("max"),10);"input"==r.type&&parseInt(e(this).val(),10)>c&&e(this).val(c)}t.form_ecommerce_calculate()}),this.form_ecommerce_calculate()}},e.WS_Form.prototype.form_ecommerce_input_mask_currency=function(t){var r=this;void 0===t&&(t=e('input[type="text"][data-ecommerce-price],input[data-ecommerce-cart-price],input[data-ecommerce-cart-total]',this.form_canvas_obj)),t.each(function(){var t=r.get_currency(),a={digits:t.decimals,allowMinus:e(this)[0].hasAttribute("data-ecommerce-negative"),suffix:t.suffix,groupSeparator:t.thousand_separator,prefix:t.prefix,removeMaskOnSubmit:!0,rightAlign:!1,clearMaskOnLostFocus:!1,radixPoint:t.decimal_separator};e(this)[0].hasAttribute("data-ecommerce-min")&&(a.min=e(this).attr("data-ecommerce-min")),e(this)[0].hasAttribute("data-ecommerce-max")&&(a.max=e(this).attr("data-ecommerce-max")),void 0!==e(this).inputmask&&e(this).inputmask("currency",a)})},e.WS_Form.prototype.form_ecommerce_calculate=function(){if(this.form_ecommerce_calculate_enabled){var t=[],r=0,a=this.get_currency(),c=[],i=this;e("input[data-ecommerce-price],select[data-ecommerce-price]",this.form_canvas_obj).not("[data-ecommerce-price-bypass],[data-ecommerce-price-bypass-section]").each(function(){var t=i.get_field_id(e(this)),r=i.get_section_repeatable_index(e(this)),a=t+i.get_section_repeatable_suffix(e(this)),m=e(this).closest("[data-ecommerce-cart-price-type]");switch(m=m.length?m.attr("data-ecommerce-cart-price-type"):"subtotal",void 0===c[a]&&(c[a]={subtotal:0,type:m,field_id:t,section_repeatable_index:r,exclude_price_cart:void 0!==e(this).attr("data-wsf-exclude-cart-total")}),e(this).attr("type")){case"checkbox":case"radio":c[a].subtotal+=e(this).is(":checked")?i.get_number(e(this).attr("data-price"),0,!0):0;break;default:e(this).is("select")?e(this).find("option:selected").each(function(){c[a].subtotal+=i.get_number(e(this).attr("data-price"),0,!0)}):c[a].subtotal+=i.get_number(e(this).val())}});var m=parseInt(e.WS_Form.settings_plugin.price_decimals,10);for(var o in c)if(c.hasOwnProperty(o)){var s=c[o].field_id,_=c[o].section_repeatable_index,n=c[o].subtotal;n=this.get_number(n,0,!1,m);var p=c[o].type,h=c[o].exclude_price_cart;if(0===_)var d=e('input[data-ecommerce-quantity][data-ecommerce-field-id="'+s+'"]',this.form_canvas_obj);else d=e('[data-repeatable-index="'+_+'"] input[data-ecommerce-quantity][data-ecommerce-field-id="'+s+'"]',this.form_canvas_obj);if(d.length)n*=this.get_number(d.first().val()),n=this.get_number(n,0,!1,m);if(0===_)var f=e('input[data-ecommerce-price-subtotal][data-ecommerce-field-id="'+s+'"]',this.form_canvas_obj);else f=e('[data-repeatable-index="'+_+'"] input[data-ecommerce-price-subtotal][data-ecommerce-field-id="'+s+'"]',this.form_canvas_obj);if(f.length){var u=this.get_number(f.val(),0,!0)!==this.get_number(n,0,!1);f.val(this.get_price(n,a)),u&&f.trigger("change")}h||(void 0===t[p]&&(t[p]=0),t[p]+=n)}for(var p in e.WS_Form.ecommerce.cart_price_types)if(e.WS_Form.ecommerce.cart_price_types.hasOwnProperty(p)){var l=e.WS_Form.ecommerce.cart_price_types[p],v=void 0===l.sum||l.sum,y=void 0!==l.render&&l.render;if("subtotal"==p){t[p]=this.get_number(t[p],0,!1,m);var g=void 0!==t[p]?t[p]:0}else{g=0;e("input[data-ecommerce-cart-price][data-ecommerce-cart-price-"+p+"]",this.form_canvas_obj).each(function(){g+=i.get_number(e(this).val())}),g=this.get_number(g,0,!1,m)}if(v&&(r+=g),y&&v){var b=this.get_price(g,a,!1),x=this.get_price(g,a),j="[data-ecommerce-cart-price-"+p+"]",S="#"+this.form_id_prefix+"ecommerce-cart-"+p;this.form_ecommerce_price_type_set(p,j,S,g,b,x)}}r=this.get_number(r,0,!1,m);b=this.get_price(r,a,!1),x=this.get_price(r,a);this.ecommerce_cart_price_type.total={float:r,string:b,currency:x};j="[data-ecommerce-cart-total]",S="#"+this.form_id_prefix+"ecommerce-cart-total";this.form_ecommerce_price_type_set(!1,j,S,r,b,x)}},e.WS_Form.prototype.form_ecommerce_price_type_set=function(t,r,a,c,i,m){var o=this;(s=e(r,this.form_canvas_obj)).each(function(){if(e(this).is("input")){var t=o.get_number(m,0),r=e(this)[0].hasAttribute("data-ecommerce-negative");t<0&&!r&&o.error("error_ecommerce_negative_value",o.get_field_id(e(this)),"error-ecommerce");var a=o.get_number(e(this).val(),0,!0)!=t;e(this).val(i),a&&e(this).trigger("change")}if(e(this).is("span")){var c=void 0!==e(this).attr("data-ecommerce-price-currency")?m:i;e(this).html(c)}});var s=e(a,this.form_canvas_obj),_=o.get_number(s.val(),0,!1)!=o.get_number(c,0,!1);s.val(c),_&&s.trigger("change"),!1!==t&&(this.ecommerce_cart_price_type[t]={float:c,string:i,currency:m})},e.WS_Form.prototype.form_ecommerce_payment_error=function(e){this.error("error_payment",e,"payment")},e.WS_Form.prototype.form_ecommerce_payment_process=function(e,t,r){this.form_ecommerce_set_status("completed"),this.form_ecommerce_set_transaction_id(e),this.form_ecommerce_set_payment_method(r),this.form_ecommerce_set_payment_amount(t),this.form_obj.submit()},e.WS_Form.prototype.form_ecommerce_set_status=function(t){e("#"+this.form_id_prefix+"ecommerce-status",this.form_canvas_obj).val(t),this.log("log_ecommerce_status",t,"ecommerce")},e.WS_Form.prototype.form_ecommerce_set_transaction_id=function(t){e("#"+this.form_id_prefix+"ecommerce-transaction-id",this.form_canvas_obj).val(t),this.log("log_ecommerce_transaction_id",t,"ecommerce")},e.WS_Form.prototype.form_ecommerce_set_transaction=function(t){e("#"+this.form_id_prefix+"ecommerce-transaction",this.form_canvas_obj).val(t)},e.WS_Form.prototype.form_ecommerce_set_payment_method=function(t){e("#"+this.form_id_prefix+"ecommerce-payment-method",this.form_canvas_obj).val(t),this.log("log_ecommerce_payment_method",t,"ecommerce")},e.WS_Form.prototype.form_ecommerce_set_payment_amount=function(t){this.form_ecommerce_calculate_enabled=!1,e("#"+this.form_id_prefix+"ecommerce-cart-total",this.form_canvas_obj).val(t).trigger("change"),this.log("log_ecommerce_payment_amount",t,"ecommerce")}}(jQuery);