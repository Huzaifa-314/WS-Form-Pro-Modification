!function(e){"use strict";e.WS_Form.prototype.form_google_api_init=function(){if(!e("#wsf-google-map-script-head").length){"var wsf_google_maps_loaded = false;","function wsf_google_map_onload() {","wsf_google_maps_loaded = true;","}","<\/script>",e("head").append('<script id="wsf-google-map-script-head">var wsf_google_maps_loaded = false;function wsf_google_map_onload() {wsf_google_maps_loaded = true;}<\/script>')}if(!(window.google&&window.google.maps||e("#wsf-google-map-script-body").length)){var o='<script id="wsf-google-map-script-body" src="https://maps.googleapis.com/maps/api/js?key='+e.WS_Form.settings_plugin.api_key_google_map+'&callback=wsf_google_map_onload&libraries=places&v=weekly" async defer><\/script>';e("body").append(o)}},e.WS_Form.prototype.form_google_map=function(){var o=this,t=e("[data-google-map]:not([data-init-google-map])",this.form_canvas_obj);if(!t.length)return!1;this.form_google_api_init(),this.google_maps=[],t.each(function(){e(this).attr("data-init-google-map","");var t=o.get_field_id(e(this)),a=o.get_field(e(this)),_={};_.id=e(this).attr("id"),_.id_map=_.id+"-map",_.obj=e(this),_.obj_map=e("#"+_.id_map,o.form_canvas_obj),_.height=o.parse_variables_process(o.get_object_meta_value(a,"google_map_height","")).output,_.height&&_.obj_map.css({height:0,overflow:"hidden","padding-bottom":_.height,position:"relative"}),_.lat=o.parse_variables_process(o.get_object_meta_value(a,"google_map_lat","")).output,_.lng=o.parse_variables_process(o.get_object_meta_value(a,"google_map_lng","")).output,_.zoom=o.parse_variables_process(o.get_object_meta_value(a,"google_map_zoom","")).output,_.zoom?_.zoom=parseInt(_.zoom,10):_.zoom=14,_.type=o.get_object_meta_value(a,"google_map_type",""),_.type||(_.type="roadmap"),_.search_field_id=parseInt(o.get_object_meta_value(a,"google_map_search_field_id",0),10),_.marker_icon_title=o.parse_variables_process(o.get_object_meta_value(a,"google_map_marker_icon_title","")).output,_.marker_icon_url=o.parse_variables_process(o.get_object_meta_value(a,"google_map_marker_icon_url","")).output,_.style=o.parse_variables_process(o.get_object_meta_value(a,"google_map_style","")).output,_.control_type=""!==o.get_object_meta_value(a,"google_map_control_type","on"),_.control_full_screen=""!==o.get_object_meta_value(a,"google_map_control_full_screen","on"),_.control_street_view=""!==o.get_object_meta_value(a,"google_map_control_street_view","on"),_.control_zoom=""!==o.get_object_meta_value(a,"google_map_control_zoom","on"),o.google_maps[t]=_,o.google_map_process(_)})},e.WS_Form.prototype.google_map_process=function(o,t){var a=this;if(o.reposition=!0,void 0===t&&(t=(new Date).getTime()),(new Date).getTime()-t>this.timeout_google_maps)return this.error("error_timeout_google_maps"),!1;if(window.google&&window.google.maps&&(wsf_google_maps_loaded=!0),wsf_google_maps_loaded){o.obj.attr("data-default-value",o.obj.val()),o.geocoder=new google.maps.Geocoder,o.height&&o.obj_map.css({height:0,overflow:"hidden","padding-bottom":o.height,position:"relative"}),o.geolocate_process=function(e){o.geocoder.geocode({location:e},function(t,a){"OK"===a&&t[0]?(o.search_field_obj&&o.search_field_obj.val(t[0].formatted_address),o.marker_set_position(e,t[0])):(o.search_field_obj&&o.search_field_obj.val(""),o.marker_set_position(e))})},o.set_field_value=function(e){var t=JSON.stringify(e),a=o.obj.val()!==t;o.obj.val(t),a&&o.obj.trigger("change")},o.marker_set_position=function(e,t){var a={lat:e.lat(),lng:e.lng(),zoom:o.map.getZoom(),map_type_id:o.map.getMapTypeId()};void 0!==t&&(a.place_id=(t.place_id,t.place_id),a.address=(t.formatted_address,t.formatted_address),a.name=(t.name,t.name),void 0!==t.address_components&&t.address_components.forEach(function(e){var o=e.types;-1!==o.indexOf("locality")&&(a.city=e.long_name),-1!==o.indexOf("administrative_area_level_1")&&(a.city=e.long_name),-1!==o.indexOf("country")&&(a.country=e.long_name,a.country_short=e.short_name)})),o.set_field_value(a)},o.obj.on("change",function(){var t=!1,a=e(this).val();try{var _=JSON.parse(a)}catch(t){var r=a.split(",");if(2===r.length){_={lat:r[0],lng:r[1]};void 0!==r[2]&&(_.zoom=r[2]),void 0!==r[3]&&(_.map_type_id=r[3]),e(this).val(JSON.stringify(_)),o.geolocate_process(new google.maps.LatLng(parseFloat(_.lat),parseFloat(_.lng)))}else _=!1}if(!1!==_){var s=new google.maps.LatLng(parseFloat(_.lat),parseFloat(_.lng));t=!0,o.search_field_obj&&_.address&&_.address!=o.search_field_obj.val()&&o.search_field_obj.val(_.address),_.zoom&&_.zoom!=o.map.getZoom()&&o.map.setZoom(_.zoom),_.map_type_id&&_.map_type_id!=o.map.getMapTypeId()&&o.map.setMapTypeId(_.map_type_id)}else{if(o.lat&&o.lng)s=new google.maps.LatLng(parseFloat(o.lat),parseFloat(o.lng));else s=new google.maps.LatLng(29.95,-90.08);o.map.setZoom(o.zoom),o.map.setMapTypeId(o.type)}o.marker.setPosition(s),o.marker.setVisible(t),o.reposition&&o.map.setCenter(s)});var _={id:o.id_map,zoom:o.zoom,mapTypeId:o.type,clickableIcons:!1,gestureHandling:"cooperative",mapTypeControl:o.control_type,fullscreenControl:o.control_full_screen,streetViewControl:o.control_street_view,zoomControl:o.control_zoom};if(o.style)try{_.styles=JSON.parse(o.style)}catch(e){this.error("error_google_map_style_js")}var r=new google.maps.Map(o.obj_map[0],_);o.map=r,o.map.addListener("zoom_changed",function(){var e=o.obj.val();if(""!=e){try{var t=JSON.parse(e)}catch(e){return}"object"==typeof t&&(t.zoom=o.map.getZoom(),o.set_field_value(t))}}),o.map.addListener("maptypeid_changed",function(){var e=o.obj.val();if(""!=e){try{var t=JSON.parse(e)}catch(e){return}"object"==typeof t&&(t.map_type_id=o.map.getMapTypeId(),o.set_field_value(t))}}),o.map.addListener("click",function(e){o.reposition=!1,o.marker_set_position(e.latLng),o.geolocate_process(e.latLng)});var s={map:r,visible:!1,draggable:!0};if(o.marker_icon_url&&(void 0===s.icon&&(s.icon={}),s.icon.url=o.marker_icon_url),o.marker_icon_title&&(s.title=o.marker_icon_title),o.marker=new google.maps.Marker(s),o.marker.addListener("dragend",function(){o.reposition=!1;var e=this.getPosition().lat(),t=this.getPosition().lng();o.geolocate_process(new google.maps.LatLng(e,t))}),o.obj.parent().find('[data-action="wsf-google-map-clear"]').on("click",function(e){e.preventDefault(),o.obj.val("").trigger("change")}),o.search_field_id){var i=a.get_section_repeatable_suffix(o.obj),l=parseInt(o.search_field_id,10),n=e('[id^="'+a.form_id_prefix+"field-"+l.toString()+i+'"]',a.form_canvas_obj);if(i&&!n.length)n=e('[id^="'+a.form_id_prefix+"field-"+l.toString()+'"]',a.form_canvas_obj);if(n.length){o.search_field_obj=n;var g=n[0];o.search_box=new google.maps.places.SearchBox(g),o.map.addListener("bounds_changed",function(){o.search_box.setBounds(o.map.getBounds())}),o.search_box.addListener("places_changed",function(){o.reposition=!0;var e=o.search_box.getPlaces();0!=e.length&&e.forEach(function(e){e.geometry&&(o.marker_set_position(e.geometry.location,e),e.geometry.viewport&&o.map.fitBounds(e.geometry.viewport))})})}}o.obj.trigger("change")}else setTimeout(function(){a.google_map_process(o,t)},this.timeout_interval)},e.WS_Form.prototype.form_google_address=function(){var o=this,t=e("[data-google-address]:not([data-init-google-address])",this.form_canvas_obj);if(!t.length)return!1;this.form_google_api_init(),t.each(function(){e(this).attr("data-init-google-address","");var t={},a=o.get_field(e(this));t.obj=this,t.field_id=o.get_field_id(e(this)),t.field_mapping=o.get_object_meta_value(a,"google_address_field_mapping",[]),t.map_field_id=o.get_object_meta_value(a,"google_address_map",""),t.map_zoom=parseInt(o.get_object_meta_value(a,"google_address_map_zoom","14"),10);var _=o.get_object_meta_value(a,"google_address_restriction_country",[]);if(t.restriction_country=[],"object"==typeof _&&_.length)for(var r in _)if(_.hasOwnProperty(r)){var s=_[r];s.country_alpha_2&&t.restriction_country.push(s.country_alpha_2)}t.restriction_business=o.get_object_meta_value(a,"google_address_restriction_business",""),o.google_address_process(t)})},e.WS_Form.prototype.google_address_get_field_obj=function(o,t){var a=this.get_section_repeatable_suffix(o),_=e('[id^="'+this.form_id_prefix+"field-"+t+a+'"]',this.form_canvas_obj);if(a&&!_.length)_=e('[id^="'+this.form_id_prefix+"field-"+t+'"]',this.form_canvas_obj);return!!_.length&&_.first()},e.WS_Form.prototype.google_address_process=function(o,t){var a=this;if(void 0===t&&(t=(new Date).getTime()),(new Date).getTime()-t>this.timeout_google_maps)return this.error("error_timeout_google_maps"),!1;if(window.google&&window.google.maps&&(wsf_google_maps_loaded=!0),wsf_google_maps_loaded){var _={fields:["address_components","business_status","formatted_address","formatted_phone_number","geometry","international_phone_number","name","place_id","rating","url","vicinity","website"]};switch(o.restriction_business){case"on":case"establishment":_.types=["establishment"];break;case"address":case"(cities)":case"(regions)":_.types=[o.restriction_business]}"object"==typeof o.restriction_country&&o.restriction_country.length&&(_.componentRestrictions={country:o.restriction_country});var r=new google.maps.places.Autocomplete(o.obj,_);r.google_address=o,r.addListener("place_changed",function(){var t=this.getPlace(),_=[];for(var r in _.street_full_short="",_.street_full_long="",_.postal_code_full_short="",_.postal_code_full_long="",t.address_components)if(t.address_components.hasOwnProperty(r)){var s=t.address_components[r];switch(s.types[0]){case"street_number":_.street_number_short=s.short_name,_.street_number_long=s.long_name,_.street_full_short=s.short_name+" "+_.street_full_short,_.street_full_long=s.long_name+" "+_.street_full_long;break;case"route":_.route_short=s.short_name,_.route_long=s.long_name,_.street_full_short+=s.short_name,_.street_full_long+=s.long_name;break;case"locality":case"postal_town":_.locality_short=s.short_name,_.locality_long=s.long_name;break;case"sublocality":_.sublocality_short=s.short_name,_.sublocality_long=s.long_name;break;case"subpremise":_.subpremise_short=s.short_name,_.subpremise_long=s.long_name;break;case"neighborhood":_.neighborhood_short=s.short_name,_.neighborhood_long=s.long_name;break;case"administrative_area_level_1":_.aal1_short=s.short_name,_.aal1_long=s.long_name;break;case"administrative_area_level_2":_.aal2_short=s.short_name,_.aal2_long=s.long_name;break;case"postal_code":_.postal_code_short=s.short_name,_.postal_code_long=s.long_name,_.postal_code_full_short=s.short_name+_.postal_code_full_short,_.postal_code_full_long=s.long_name+_.postal_code_full_long;break;case"postal_code_suffix":_.postal_code_suffix_short=s.short_name,_.postal_code_suffix_long=s.long_name,_.postal_code_full_short=_.postal_code_full_short+"-"+s.short_name,_.postal_code_full_long=_.postal_code_full_long+"-"+s.long_name;break;case"country":_.country_short=s.short_name,_.country_long=s.long_name}}if(t.geometry&&t.geometry.location){var i=t.geometry.location;_.lat=i.lat(),_.lng=i.lng(),_.lat_lng=i.lat()+","+i.lng()}var l=["business_status","formatted_address","formatted_phone_number","international_phone_number","name","place_id","rating","url","vicinity","website"];for(var n in l)if(l.hasOwnProperty(n)){var g=l[n];_[g]=t[g]?t[g]:""}if("object"==typeof o.field_mapping&&o.field_mapping.length)for(var p in o.field_mapping)if(o.field_mapping.hasOwnProperty(p)){var m=o.field_mapping[p],d=void 0!==m.google_address_component?m.google_address_component:"";if(""!=d){void 0===_[d]&&(_[d]="");var c=parseInt(void 0!==m.ws_form_field?m.ws_form_field:"",10);if(0!=c){var f=a.google_address_get_field_obj(e(o.obj),c);if(f){var u=_[d],h=f.val()!==u;f.val(u),h&&f.trigger("change")}}}}if(""!=o.map_field_id&&void 0!==a.google_maps[o.map_field_id]&&t.geometry&&t.geometry.location){var v=a.google_maps[o.map_field_id];v.marker_set_position(t.geometry.location,t),t.geometry.viewport&&v.map.fitBounds(t.geometry.viewport),o.map_zoom>0&&v.map.setZoom(o.map_zoom)}})}else setTimeout(function(){a.google_address_process(o,t)},this.timeout_interval)}}(jQuery);